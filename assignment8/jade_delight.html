<!DOCTYPE html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Jade Delight</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<link rel="stylesheet" href="mystyle.css">
</head>

<body>

<script>
//CANNOT CHANGE THIS CODE
function MenuItem(name, cost) {
	this.name = name;
	this.cost=cost;
}

menuItems = new Array(
	new MenuItem("Chicken Chop Suey", 5.5),
	new MenuItem("Sweet and Sour Pork", 7.25),
	new MenuItem("Shrimp Lo Mein", 6.80),
	new MenuItem("Moo Shi Chicken", 9.50),
	new MenuItem("Fried Rice", 3.25)
);

function makeSelect(name, minRange, maxRange) {
	var t= "";
	t = "<select name='" + name + "' size='1'>";
	for (j=minRange; j<=maxRange; j++)
	   t += "<option>" + j + "</option>";
	t+= "</select>"; 
	return t;
}

function td(content, className="") {
	return "<td class = '" + className + "'>" + content + "</td>";
}
// CANNOT CHANGE THIS CODE
</script>

<h1>Jade Delight</h1>
<form>

<p class="userInfo"><label>First Name:</label> <input type="text"  name='fname' /></p>
<p class="userInfo"><label>Last Name*:</label>  <input type="text"  name='lname' /></p>
<p class="userInfo address"><label>Street*:</label> <input type="text" name='street' /></p>
<p class="userInfo address"><label>City*:</label> <input type="text" name='city' /></p>
<p class="userInfo"><label>Phone*:</label> <input type="text"  name='phone' /></p>
<p> 
	<input type="radio"  name="p_or_d" value = "pickup" checked="checked"/>Pickup  
	<input type="radio"  name='p_or_d' value = 'delivery'/>
	Delivery
</p>
<table border="0" cellpadding="3">
  <tr>
    <th>Select Item</th>
    <th>Item Name</th>
    <th>Cost Each</th>
    <th>Total Cost</th>
  </tr>
<script>

  var s = "";
  for (i=0; i< menuItems.length; i++)
  {
	  s += "<tr>";
	  s += td(makeSelect("quan" + i, 0, 10),"selectQuantity");
	  s += td(menuItems[i].name, "itemName");
	  s += td("$" +menuItems[i].cost.toFixed(2), "cost");
	  s += td("$<input type='text' name='cost'/>", "totalCost");
	  s+= "</tr>";
  }
  document.writeln(s);
</script>
</table>
<p class="subtotal totalSection"><label>Subtotal</label>: 
   $ <input type="text"  name='subtotal' id="subtotal" />
</p>
<p class="tax totalSection"><label>Mass tax 6.25%:</label>
  $ <input type="text"  name='tax' id="tax" />
</p>
<p class="total totalSection"><label>Total:</label> $ <input type="text"  name='total' id="total" />
</p>

<input type = "button" value = "Submit Order" />

</form>
<!-- // CANNOT CHNAGE THIS CODE -->


</body>

<script> 
	//MY JS CODE STARTS HERE!
	
	//form element variables
	const form = document.getElementsByTagName("form")[0];
	var formInput = document.querySelector("form")[0];
	//submit button element variable 
	var submitButton = document.querySelector("input[type=button]");
	
	//form elements variables (for calculations)
	const itemTotalCost = form.elements["cost"];
	const subtotal = form.elements["subtotal"];
	const taxTotal = form.elements["tax"];
	const total = form.elements["total"];

	//form elements variables (for user input)
	const address = document.getElementsByClassName("userInfo address");
	const street = document.getElementsByName("street")[0];
	const city = document.getElementsByName("city")[0];
	const lname = document.getElementsByName("lname")[0];
	const phone = document.getElementsByName("phone")[0];

	//delivery or pickup element variable
	const orderType = document.getElementsByName("p_or_d")[0];

	//item costs + name array variables
	const itemCosts = [5.5, 7.25, 6.8, 9.5, 3.25];
	const itemName = ["Chicken Chop Suey", "Sweet and Sour Pork", "Shrimp Lo Mein", "Moo Shi Chicken", "Fried Rice"];
	
	//item quantities by user input array variable
	const itemQuant = [form["quan0"], form["quan1"], form["quan2"], form["quan3"], form["quan4"]];

	// Function: updateTotal()
	// Purpose: This function updates the item totals, subtotals, tax, and total when the user inputs information.
	// Description: This function creates variables to save the total information as well as a counter variable i.
	//				it uses a for loop to iterate through the item quanities to update the item total cost box while
	//				adding to the subtotal. This function also calculates the subtotal, tax, and total.
	//				Before printing the new totals, the function uses toFixed() to round to 2 decimal places.
	// Input: N/a
	// Output: N/a
	function updateTotal() {
		var totalCost = 0;
		var subtotaling = 0;
		var taxing = 0;
		var totaling = 0;
		var i;
		for (i=0; i<5; i++) {
			//updating item total costs
			totalCost = (itemQuant[i].value)*(itemCosts[i]);
			itemTotalCost[i].value = totalCost.toFixed(2);
			subtotaling = subtotaling + totalCost; 
		}
		//updating subtotal
		subtotal.value = subtotaling.toFixed(2);
		//updating tax
		taxing = subtotaling*.0625
		tax.value = taxing.toFixed(2);
		//updating total
		totaling = subtotaling + taxing;
		total.value = totaling.toFixed(2);
	}
 
	//hides street + city fields unless the user selects delivery
	$(address).hide();

	// Function: delivery()
	// Purpose: This function shows the address input fields when the user clicks the delivery option.
	// Description: This function uses a if else statement which checks if the pickup field is checked.
	//				If it is not checked, it hides the address fields. If it is checked it shows the fields.
	// Input: N/a
	// Output: N/a
	function delivery() {
		if(!orderType.checked) {
			$(address).show();
		}
		else {
			$(address).hide();
		}
	}

	// Function: getFoodTime()
	// Purpose: This function calculates the time that the food will be ready for the customer.
	// Description: This function first gets the time using the Date class and then saves that
	//				information to variables. Then it checks if the order is delivery or pickup.
	//				Depending on that information it will either add 20 or 40 minutes to the
	//				minutes, checking to see if the time will be in a new hour. 
	// Input: N/a
	// Output: The function returns the dateTime variable which is a string that includes the
	//			pickup or delivery time.
	function getFoodTime() {
		var now = new Date();
		var date = now.getFullYear()+'-'+(now.getMonth()+1)+'-'+now.getDate();
		var hours = now.getHours();
		var minutes = now.getMinutes();
		//if delivery +40 mins
		if (!orderType.checked) {
			if ((minutes + 40) >= 60) {
				minutes = (minutes + 40) - 60;
				hours = hours + 1;
			}
			else {
				minutes = minutes + 40;
			}
		}
		//if pickup +20 mins
		else {
			if ((minutes + 20) >= 60) {
				minutes = (minutes + 20) - 60;
				hours = hours + 1;
			}
			else {
				minutes = minutes + 20;
			}
		}	
		var time = hours + ":" + minutes;
		var dateTime = date +' '+time;
		return dateTime;
	}


	// Function: validateForm()
	// Purpose: This function validates that the form includes all necessary order information.
	// Description: The function first checks in the order is delivery in that case it will make sure 
	//				The user has input a delivery address. Then the function checks if the user has 
	//				put in a last name as well as a valid phone number. Last, it checks if the user has
	//				ordered at least one item from the menu. Finally, if the form checks all validations
	//				the function will send an alert to the user that their order was submitted and the
	//				function will call the orderDetails() function.
	// Input: N/a
	// Output: N/a
	function submitted() {
		//delivery order
		if(!orderType.checked) {
			//if delivery validate street + city
			if(street.value == "" || city.value == "") {
				alert("Please input a complete delivery address for your order.");
			}
 		}
		//verify last name + phone was entered
		if (lname.value == "") {
			alert("Please input a last name for your order");
		}
		if (phone.value == "") {
			alert("Please input a phone number for your order.");
		}
		//verify phone number has either (7 or 10 numbers)
		if ((phone.value.replace(/[^0-9]/g, "").length)!=10 && (phone.value.replace(/[^0-9]/g, "").length)!=7) {
			alert("Please input a valid phone number for your order.");
		} 
		//verify at least one item ordered
		if (itemQuant[0].value == 0 && itemQuant[1].value == 0 && itemQuant[2].value == 0 && itemQuant[3].value == 0 && itemQuant[4].value == 0) { 
			alert("Please order at least one item from the menu.");
		}
		//no issues with order!
		else {
			alert("Thank you for your order!");
			orderDetails();
		}
	}
	 

	// Function: orderDetails()
	// Purpose: This function shows all the order details in a new window.
	// Description: This function creates a new window variable which prints the quantity, item and cost
	//				for each ordered item. It also prints the subtotal, tax and total. Finally, the function
	//				checks whether the order is delivery or pickup and calls the getFoodTime() function
	//				to print the time when the food will be ready or delivered. 
	// Input: N/a
	// Output: N/a
	function orderDetails() {
		var newWindow = window.open();
		var totalCost = 0;
		//items/quantity/cost for each subtotals/tax/total
		newWindow.document.write("Ordered Items:<br>");
		for(i=0;i<5;i++) {
			if (itemQuant[i].value != 0) {
				newWindow.document.write(itemQuant[i].value + " " + itemName[i] + ": ");
				totalCost = (itemQuant[i].value)*(itemCosts[i]);
				newWindow.document.write("$" + totalCost.toFixed(2) + "<br>");
			}
			else {
				continue;
			}
		}
		//subtotal
		newWindow.document.write("Subtotal: $" + subtotal.value);
		//tax
		newWindow.document.write("<br>Tax: $" + tax.value);
		//total
		newWindow.document.write("<br>Total: $" + total.value);
		//pickup or delivery time
		//delivery order
		if(!orderType.checked) {
			newWindow.document.write("<br> Your order will be delivered at: " + getFoodTime());
		}
		//pickup order
		else {
			newWindow.document.write("<br> Your order will be ready for pickup at: " + getFoodTime());
		}
	}


	// Function: updateForm()
	// Purpose: This function calls the functions that will update the form when the user inputs information.
	// Description: This function calls the updateTotal() and delivery() functions.
	// Input: N/a
	// Output: N/a
	 function updateForm() {
		updateTotal();
		delivery();
	 }
	 
	//event listener for updating form when there is a change
	 form.addEventListener('change', updateForm);
	//event listener for when the user submits the form
	 submitButton.addEventListener('click', submitted);
	
</script>
</html>